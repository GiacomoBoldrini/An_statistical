// Class: ReadSVM
// Automatically generated by MethodBase::MakeClass
//

/* configuration options =====================================================

#GEN -*-*-*-*-*-*-*-*-*-*-*- general info -*-*-*-*-*-*-*-*-*-*-*-

Method         : SVM::SVM
TMVA Release   : 4.2.1         [262657]
ROOT Release   : 6.16/00       [397312]
Creator        : boldrinicoder
Date           : Mon Jul  8 13:08:58 2019
Host           : Darwin macitois21.cern.ch 18.2.0 Darwin Kernel Version 18.2.0: Mon Nov 12 20:24:46 PST 2018; root:xnu-4903.231.4~2/RELEASE_X86_64 x86_64
Dir            : /Users/boldrinicoder/uni/Analisi-Statistica/code/es7
Training events: 16000
Analysis type  : [Classification]


#OPT -*-*-*-*-*-*-*-*-*-*-*-*- options -*-*-*-*-*-*-*-*-*-*-*-*-

# Set by User:
# Default:
V: "False" [Verbose output (short form of "VerbosityLevel" below - overrides the latter one)]
VerbosityLevel: "Default" [Verbosity level]
VarTransform: "None" [List of variable transformations performed before training, e.g., "D_Background,P_Signal,G,N_AllClasses" for: "Decorrelation, PCA-transformation, Gaussianisation, Normalisation, each for the given class of events ('AllClasses' denotes all events of all classes, if no class indication is given, 'All' is assumed)"]
H: "False" [Print method-specific help message]
CreateMVAPdfs: "False" [Create PDFs for classifier outputs (signal and background)]
IgnoreNegWeightsInTraining: "False" [Events with negative weights are ignored in the training (but are included for testing and performance evaluation)]
Kernel: "RBF" [Pick which kernel ( RBF or MultiGauss )]
Gamma: "1.000000e+00" [RBF kernel parameter: Gamma (size of the Kernel)]
Order: "3" [Polynomial Kernel parameter: polynomial order]
Theta: "1.000000e+00" [Polynomial Kernel parameter: polynomial theta]
GammaList: "" [MultiGauss parameters]
Tune: "All" [Tune Parameters]
KernelList: "None" [Sum or product of kernels]
Loss: "hinge" [Loss function]
C: "1.000000e+00" [Cost parameter]
Tol: "1.000000e-02" [Tolerance parameter]
MaxIter: "1000" [Maximum number of training loops]
##


#VAR -*-*-*-*-*-*-*-*-*-*-*-* variables *-*-*-*-*-*-*-*-*-*-*-*-

NVar 2
x                             x                             x                             x                                                               'F'    [-1.19299423695,7.63731431961]
y                             y                             y                             y                                                               'F'    [-1.14008235931,7.63404464722]
NSpec 0


============================================================================ */

#include <array>
#include <vector>
#include <cmath>
#include <string>
#include <iostream>

#ifndef IClassifierReader__def
#define IClassifierReader__def

class IClassifierReader {

 public:

   // constructor
   IClassifierReader() : fStatusIsClean( true ) {}
   virtual ~IClassifierReader() {}

   // return classifier response
   virtual double GetMvaValue( const std::vector<double>& inputValues ) const = 0;

   // returns classifier status
   bool IsStatusClean() const { return fStatusIsClean; }

 protected:

   bool fStatusIsClean;
};

#endif

class ReadSVM : public IClassifierReader {

 public:

   // constructor
   ReadSVM( std::vector<std::string>& theInputVars )
      : IClassifierReader(),
        fClassName( "ReadSVM" ),
        fNvars( 2 )
   {
      // the training input variables
      const char* inputVars[] = { "x", "y" };

      // sanity checks
      if (theInputVars.size() <= 0) {
         std::cout << "Problem in class \"" << fClassName << "\": empty input vector" << std::endl;
         fStatusIsClean = false;
      }

      if (theInputVars.size() != fNvars) {
         std::cout << "Problem in class \"" << fClassName << "\": mismatch in number of input values: "
                   << theInputVars.size() << " != " << fNvars << std::endl;
         fStatusIsClean = false;
      }

      // validate input variables
      for (size_t ivar = 0; ivar < theInputVars.size(); ivar++) {
         if (theInputVars[ivar] != inputVars[ivar]) {
            std::cout << "Problem in class \"" << fClassName << "\": mismatch in input variable names" << std::endl
                      << " for variable [" << ivar << "]: " << theInputVars[ivar].c_str() << " != " << inputVars[ivar] << std::endl;
            fStatusIsClean = false;
         }
      }

      // initialize min and max vectors (for normalisation)
      fVmin[0] = 0;
      fVmax[0] = 0;
      fVmin[1] = 0;
      fVmax[1] = 0;

      // initialize input variable types
      fType[0] = 'F';
      fType[1] = 'F';

      // initialize constants
      Initialize();

   }

   // destructor
   virtual ~ReadSVM() {
      Clear(); // method-specific
   }

   // the classifier response
   // "inputValues" is a vector of input values in the same order as the
   // variables given to the constructor
   double GetMvaValue( const std::vector<double>& inputValues ) const override;

 private:

   // method-specific destructor
   void Clear();

   // common member variables
   const char* fClassName;

   const size_t fNvars;
   size_t GetNvar()           const { return fNvars; }
   char   GetType( int ivar ) const { return fType[ivar]; }

   // normalisation of input variables
   double fVmin[2];
   double fVmax[2];
   double NormVariable( double x, double xmin, double xmax ) const {
      // normalise to output range: [-1, 1]
      return 2*(x - xmin)/(xmax - xmin) - 1.0;
   }

   // type of input variable: 'F' or 'I'
   char   fType[2];

   // initialize internal variables
   void Initialize();
   double GetMvaValue__( const std::vector<double>& inputValues ) const;

   // private members (method specific)
   // not implemented for class: "ReadSVM"
   float        fBparameter;
   int          fNOfSuppVec;
   static float fAllSuppVectors[][170];
   static float fAlphaTypeCoef[170];

   // Kernel parameter(s) 
   float fGamma;
};

inline void ReadSVM::Initialize() 
{
   fBparameter = -0.716014981269836;
   fNOfSuppVec = 170;
   fGamma = 1;
}

inline double ReadSVM::GetMvaValue__(const std::vector<double>& inputValues ) const
{
   double mvaval = 0; 
   double temp = 0; 

   for (int ievt = 0; ievt < fNOfSuppVec; ievt++ ){
      temp = 0;
      for ( unsigned int ivar = 0; ivar < GetNvar(); ivar++ ) {
         temp += (fAllSuppVectors[ivar][ievt] - inputValues[ivar])  
               * (fAllSuppVectors[ivar][ievt] - inputValues[ivar]); 
      }
      mvaval += fAlphaTypeCoef[ievt] * exp( -fGamma * temp ); 
   }
   mvaval -= fBparameter;
   return 1./(1. + exp(mvaval));
}
// Clean up
inline void ReadSVM::Clear() 
{
   // nothing to clear 
}

float ReadSVM::fAlphaTypeCoef[] =
{ 0.0462563037872314, 0.0304860807955265, 0.0130403358489275, 0.00399582367390394, 0.0186319965869188, 0.010000616312027, 0.0605149790644646, 0.0132528133690357, 0.024902481585741, 0.0202371366322041, 0.0146566992625594, 0.0153118073940277, 0.0101459324359894, 0.0132041489705443, 0.0146246924996376, 0.010449425317347, 0.0354934893548489, 0.0160806905478239, 0.000611112453043461, 0.028272807598114, -1, 0.0180985610932112, 0.00203828141093254, 0.0335603952407837, 0.00981827452778816, 0.01103943772614, 0.0128500731661916, 0.0241695791482925, 0.00133715476840734, 0.00444619730114937, 0.0100671453401446, 0.011853564530611, 0.0031353235244751, 0.0109355440363288, 0.0108761982992291, -0.854446291923523, 0.0100254015997052, 0.0216668359935284, 0.0456507951021194, 0.0100288987159729, 0.0263563878834248, 0.0106366211548448, 0.0239051524549723, 0.0103816986083984, 0.00660782121121883, 0.0255686081945896, 0.0117840245366096, 0.000881761312484741, 0.147767901420593, 0.104597993195057, 0.0111892744898796, 0.0719373002648354, 0.00760916993021965, 0.107799082994461, -0.376716405153275, 3.72529029846191e-09, 0.0818942785263062, 0.0111477207392454, 0.0132673382759094, 0.0175529718399048, 0.013153568841517, 0.00341333635151386, 0.00523636117577553, 0.00270566716790199, 0.0218711216002703, 0.0104625001549721, 0.0159165430814028, 0.0441148914396763, 0.0104962904006243, 0.00137283280491829, 0.0126536190509796, 0.0124549549072981, 0.0832462757825851, 0.0101309092715383, 0.0152594968676567, 0.0162028763443232, -1, 0.0221138820052147, 0.103063479065895, 0.0132325896993279, 0.117846146225929, 1, 0.0439267605543137, 0.0111149754375219, 0.0335151292383671, 0.0116918021813035, 0.162913978099823, 0.00911465659737587, 0.0134221278131008, 0.0235032998025417, 0.166043907403946, 0.0103187235072255, 0.24858084321022, 0.010314354673028, 0.0105734411627054, 0.0126817524433136, 1, 0.0116439461708069, 0.00124556198716164, 0.0100047811865807, 0.0103773800656199, 0.00737958028912544, -0.643752634525299, 0.010303714312613, 0.0332095436751842, -0.697948694229126, 0.0103309154510498, 0.0366664752364159, 0.00386818870902061, 0.012921198271215, 0.0263293404132128, 0.0107956705614924, 0.114203229546547, -0.724581956863403, 0.115567773580551, 9.31322574615479e-10, 0.10638815164566, 0.0975570231676102, 0.0252513438463211, 0.00436490494757891, 0.145036220550537, 0.243618935346603, -0.681803703308105, 0.0202678442001343, 0.0101885199546814, 0.0127485394477844, 0.0110429022461176, 0.166939914226532, 0.000310054048895836, 0.077361561357975, 0.0306574273854494, 0.0100645422935486, 0.0132663249969482, 0.00339782331138849, 0.010003543458879, 1, 0.0102924108505249, 0.0109142055734992, 0.010665588080883, 0.0801568031311035, 0.0186189115047455, 0.00879597663879395, 0.0107205780223012, 0.016224542632699, 0.0125599801540375, 0.0026119677349925, 0.0100103355944157, 0.010017603635788, 0.202086895704269, -0.949165463447571, 0.0105110323056579, 0.0100731234997511, 0.0344017036259174, 0.0104517340660095, -1, -0.0145869255065918, 0.0128007000312209, 1, -1, 0.0212642438709736, 0.0109839700162411, 0.0754514709115028, 0.0111572043970227, 0.0132634937763214, 0.00845889654010534, 0.0105641186237335, 0.0139935910701752, 0.0387732461094856, 0.0114713730290532, 0.197078287601471 };

float ReadSVM::fAllSuppVectors[][170] =
{
   { 3.2206449508667, 2.05919146537781, 4.14327430725098, 3.72171998023987, 4.72922611236572, 4.65991353988647, 1.69719576835632, 4.63041687011719, 2.63651323318481, 3.98959040641785, 2.41749691963196, 4.71827507019043, 4.14244699478149, 4.09589529037476, 6.31953716278076, 4.17678260803223, 4.19014358520508, 3.09888100624084, 4.03529644012451, 2.83518314361572, 0.747590303421021, 4.11552333831787, 3.0901939868927, 2.61777758598328, 2.22298240661621, 2.85124325752258, 2.32822108268738, 4.16797399520874, 4.08075666427612, 5.51611185073853, 4.1810507774353, 3.58356666564941, 2.48725581169128, 5.9267258644104, 3.63348937034607, 1.02245795726776, 5.77046489715576, 3.70016121864319, 6.69783687591553, 2.26363444328308, 2.25682592391968, 3.72401237487793, 0.94872123003006, 5.54947948455811, 5.29367399215698, 4.99627876281738, 4.97054290771484, 5.02327632904053, 7.43140888214111, 7.0878701210022, 3.35717844963074, 3.66904377937317, 5.33633422851562, 5.60535621643066, -0.787232398986816, 3.09711527824402, 7.40091228485107, 4.24210500717163, 5.73807525634766, 5.99537181854248, 6.20037841796875, 5.11680936813354, 2.5385148525238, 2.9687647819519, 4.9129319190979, 4.54399251937866, 5.09349679946899, 1.87215518951416, 5.53925037384033, 3.45623707771301, 2.19848489761353, 3.54206013679504, 3.23957085609436, 6.1802716255188, 3.16430950164795, 5.95846843719482, 0.728290200233459, 5.61591815948486, 6.6922402381897, 5.32308959960938, 3.24364900588989, 0.863021194934845, 5.81122541427612, 4.49528694152832, 4.42450952529907, 5.09226751327515, 0.901189625263214, 4.45068120956421, 2.70837593078613, 3.59055185317993, 2.48166084289551, 6.0699610710144, 7.6373143196106, 6.0789794921875, 5.89493751525879, 2.26760101318359, 0.771108686923981, 6.22746992111206, 2.37461853027344, 5.07395601272583, 5.96321201324463, 4.07829761505127, 0.839079618453979, 4.71236228942871, 5.27167320251465, 0.186899527907372, 6.5643482208252, 5.41810131072998, 4.58130550384521, 4.59346103668213, 4.78608131408691, 5.49401473999023, 3.90367960929871, -0.504143416881561, 1.68425393104553, 4.10532903671265, 7.51970052719116, 6.29602432250977, 3.42677307128906, 4.39026737213135, 5.00338745117188, 0.438514739274979, -0.623798608779907, 5.09574031829834, 2.99267363548279, 6.20232439041138, 3.16114950180054, 5.92402458190918, 2.67174506187439, 0.927240490913391, 2.99027848243713, 4.91846942901611, 2.12847352027893, 3.31591820716858, 2.53530621528625, 0.906866192817688, 4.11746883392334, 4.26578521728516, 4.75978899002075, 6.46718740463257, 3.49063158035278, 6.30570554733276, 3.07940649986267, 4.92070436477661, 4.12573719024658, 4.52836179733276, 3.65049695968628, 6.14713144302368, 2.18815612792969, 0.711432099342346, 2.23740148544312, 2.14950060844421, 5.13444709777832, 2.74429893493652, -1.19299423694611, 0.317690402269363, 1.81554460525513, 1.30520594120026, 0.639681339263916, 5.46587133407593, 5.20939445495605, 3.34248423576355, 3.2555468082428, 3.15242147445679, 6.7068943977356, 6.37806367874146, 1.86541569232941, 4.45086431503296, 4.54789638519287, 4.53966999053955 }, 

   { 3.73291659355164, 3.14104270935059, 3.0356342792511, 4.52854299545288, 6.15838766098022, 2.31629729270935, 5.23848295211792, 4.46264410018921, 2.7918496131897, 4.20695924758911, 3.0369393825531, 6.36851167678833, 3.52926707267761, 1.81743085384369, 4.97654581069946, 4.26609468460083, 5.12675523757935, 4.37183809280396, 2.61201667785645, 4.10184526443481, 1.13490760326385, 3.38681602478027, 5.40037488937378, 4.56607675552368, 3.58077907562256, 2.72101259231567, 3.81839990615845, 5.53711795806885, 4.12337779998779, 5.09870767593384, 3.65125918388367, 1.73586773872375, 4.84092903137207, 3.71280097961426, 6.07277727127075, 0.68386435508728, 4.74731922149658, 3.90166664123535, 6.64201354980469, 4.07945013046265, 4.38746023178101, 4.33720350265503, 3.38238978385925, 4.91805362701416, 3.32784271240234, 4.02483224868774, 5.93126392364502, 3.44293761253357, 6.05805158615112, 3.97472643852234, 3.15619993209839, 6.93098115921021, 5.84488773345947, 7.53099918365479, 0.357949316501617, 6.00495386123657, 4.69502544403076, 4.97078895568848, 4.7595682144165, 4.48084211349487, 5.49095249176025, 3.69956374168396, 4.94000720977783, 5.53672790527344, 3.07029986381531, 4.70799589157104, 2.79786658287048, 5.33988189697266, 3.27055788040161, 5.82946729660034, 3.9114077091217, 5.87563133239746, 5.37124872207642, 4.65252637863159, 5.75752353668213, 3.24158596992493, 1.05742621421814, 3.64034175872803, 3.34552454948425, 3.75210046768188, 0.485745996236801, 1.49822688102722, 5.7974157333374, 4.35351657867432, 2.62732815742493, 3.02050375938416, 4.21525478363037, 2.41094851493835, 2.31769275665283, 3.29285526275635, 0.463402092456818, 5.12053251266479, 7.60198545455933, 5.58886384963989, 4.74995756149292, 2.98022770881653, 1.52510964870453, 6.0027494430542, 2.8735134601593, 3.42013764381409, 5.13729858398438, 1.6142520904541, -0.259353518486023, 4.7924280166626, 5.81876850128174, -0.854928135871887, 5.15036964416504, 4.47151803970337, 5.88757801055908, 4.92627620697021, 5.96448421478271, 4.3377423286438, 7.03804540634155, -1.14008235931396, 5.93149709701538, 6.04774856567383, 5.1639084815979, 2.55006408691406, 6.84160137176514, 6.04853630065918, 7.6340446472168, 1.79919326305389, 0.58097368478775, 3.73243975639343, 5.39807367324829, 6.47010326385498, 5.62616300582886, 1.87886226177216, 4.69142770767212, 3.67958331108093, 2.19573736190796, 5.86128377914429, 3.27020311355591, 2.23995494842529, 4.79008054733276, 1.35392272472382, 4.67123985290527, 5.19712162017822, 5.85881662368774, 7.199951171875, 1.58294725418091, 6.0694146156311, 6.00818157196045, 1.55845904350281, 3.44148969650269, 2.42510032653809, 1.42975461483002, 5.83757448196411, 6.80529403686523, 0.998005568981171, 3.58683156967163, 3.01983094215393, 1.66984975337982, 2.38753056526184, -0.606213450431824, 1.10236394405365, 4.38390350341797, 0.918208360671997, 1.11896550655365, 6.54990816116333, 5.97914791107178, 2.08970308303833, 2.76306056976318, 1.62112843990326, 3.83182215690613, 6.20032548904419, 3.37333130836487, 2.5550811290741, 2.61573386192322, 0.878245115280151 }
};

   inline double ReadSVM::GetMvaValue( const std::vector<double>& inputValues ) const
   {
      // classifier response value
      double retval = 0;

      // classifier response, sanity check first
      if (!IsStatusClean()) {
         std::cout << "Problem in class \"" << fClassName << "\": cannot return classifier response"
                   << " because status is dirty" << std::endl;
         retval = 0;
      }
      else {
            // normalise variables
            std::vector<double> iV;
            iV.reserve(inputValues.size());
            int ivar = 0;
            for (std::vector<double>::const_iterator varIt = inputValues.begin();
                 varIt != inputValues.end(); varIt++, ivar++) {
               iV.push_back(NormVariable( *varIt, fVmin[ivar], fVmax[ivar] ));
            }
            retval = GetMvaValue__( iV );
      }

      return retval;
   }
